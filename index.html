<canvas><script>for(s=Math,w=640,h=480,v=w/2,g=h/2,a=document.querySelector("canvas"),c=a.getContext("2d"),a.width=w,a.height=h,d=c.createImageData(w,h),l=[],n=w*h;n--;)l[n]=0;id=((s,h)=>s+h*w),ip=(()=>~~(3*s.random())-1),ap=((s,h)=>l[id(s,h)]++),e=(()=>{for(x=v,y=g,n=1e6;n--;)u=x-v,j=y-g,u*u+j*j>g*g*.9&&(j=s.random()*s.PI,x=v+~~(s.cos(j)*g/2),y=g+~~(s.sin(j)*g/2)),ap(x+=ip(),y+=ip())}),b=(s=>{for(;s--;)for(x=w-2;x-- >1;)for(y=h-2;y-- >1;)i=id(x,y),l[i]=(l[i]+l[i-1]+l[i+1]+l[i-w]+l[i+w])/5}),r=(()=>{for(mx=l.reduce((h,o)=>s.max(h,o)),mx=255/mx,x=w;x--;)for(y=0;y<h;){i=id(x,y),z=l[i]*mx,sh=.7+(l[i-w-1]*mx-z)/40,o=s.sin((y+x*y)*(x*y)),m=[255*sh,255*sh,255*sh,255],z<220&&(m=[200*sh+9*o,220*sh+5*o,200*sh+9*o,255]),z<150&&(m=[129*sh+3*o,226*sh+9*o,90*sh+3*o,255]),z<140&&z>90&&o>.5&&(m=[76*sh+23*o,135*sh+29*o,52*sh+13*o,255],z+=20),z<60&&(m=[240*sh,240*sh,180*sh,255]),z<50&&(m=[60,110+z+5*o,215,255]),z=~~(y-z*z/1e3);do{z>=0&&d.data.set(m,4*id(x,z))}while(y>z++);y++}}),e(),b(50),r(),c.putImageData(d,0,0);</script>
